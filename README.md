# CsprojToAsmdef

Generate [asmdef](https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html) files from csproj files inside Unity3D. Features:

- Use project references from outside or inside of your Unity project
- Add NuGet packages
- Support Roslyn analyzers
- Build Unity code using the .NET CLI. Does not support creating a runnable application

![Initialize Unity project](Images/menu_item_init_project.png)

## Installation

- Make sure a recent version of the .NET cli is installed, and ```dotnet``` is available from the PATH
- Use [OpenUPM](https://openupm.com/) to install the package
- Install the ```CsrpojToAsmdef.Cli``` tool globally

```powershell
dotnet tool install -g CsrpojToAsmdef.Cli
```

```powershell
openupm add com.kuraiandras.csprojtoasmdef
```

1. In the ```Csproj Tools``` menu click the button: ```Initialize Unity project```
2. Manually set the current Unity Version in the ```Directory.Build.props``` file (this will change)
3. Create a new ```Class Library project``` inside the Assets folder. Makes sure that the project is using .NET Standard 2.0 (.NET Framework 4.7 should also be supported, but it is not tested)
4. Add the created csproj to a solution. This preferably should be located above the base unity folder (or higher in hierarchy). Do not use the solution generated by Unity
5. Click the generate all asmdef files button
6. Make sure the ```.bin``` folder is ignored in version control
7. Make sure the ```.obj``` folder is ignored in version control
7. Make sure that .csproj files under the Assets folder are NOT ignored by version control
8. Reference NuGet packages or other .NET projects - it should be fine

The project largely relies on the [UnityAssemblies](https://github.com/DerploidEntertainment/UnityAssemblies) project. You can reference additional unity assemblies with the project properties described in that project.

You can also configure the asmdef generation via csproj properties. When the property should include multiple items each item must be separated with the ';' character. Supported properties:

| asmdef              | csproj                |
|---------------------|-----------------------|
| includePlatforms    | IncludePlatforms      |
| excludePlatforms    | ExcludePlatforms      |
| **allowUnsafeCode** | **AllowUnsafeBlocks** |
| autoReferenced      | AutoReferenced        |
| defineConstraints   | DefineConstraints     |
| noEngineReferences  | NoEngineReferences    |

## Upgrade guide

- Upgrade the UPM package to the desired version
- Install the global tool with the same version as the package

## Current State

- [VSTU](https://docs.microsoft.com/en-us/visualstudio/gamedev/unity/get-started/visual-studio-tools-for-unity) is not supported
- Debugging works, if you attach the Unity debugger manually (VSTU button -> attach unity debugger)
- ReSharper (and possibly Rider) works as expected
- VSCode can attach debugger, can't start editor.
- Unity 2019.2 and up is supported. For Unity version >= 2020.2 set the ```LangVersion``` property to 8.0, for >= 2021.2 set it to 9.0 . Keep in mind the limitations of Unity with language versions higher than 7.3
- When upgrading your Unity version set your current Unity version in the build props file.
- Multiple csproj files are supported (in separate folders), but cross referencing them is not
- Requires a Unity installation. If you want to use this in a CI/CD environment you will need to install the Unity Editor and possibly activate it with a valid license.

Contribute if you can. VSTU support seems like a mystery.
